$(document).ready(function(){function t(t,e){d.setCenter({lat:t,lng:e})}function e(t,e){d.setCenter({lat:t,lng:e})}function a(t){return pathMarker=new google.maps.Marker({position:t,map:d}),g.push(pathMarker),g}function s(t){for(var e=0;e<g.length;e++)g[e].setMap(t)}function n(t){o=new google.maps.Polyline({path:t,geodesic:!0,strokeColor:"yellow",strokeOpacity:.7,strokeWeight:2}),o.setMap(d),c.push(o),console.log(c)}function r(){for(var t=0;t<c.length;t++)c[t].setMap(null);c=[]}function l(){var t=$("#hurr").find(".tropDep").length,e=$("#hurr").find(".tropStrm").length,a=$("#hurr").find(".hur").length,s=$("#hurr").find(".majHur").length;$("#hurr .tropDep").first().addClass("tropOne"),0!=t?$("#key span.tropDep").show():$("#key span.tropDep").hide(),0!=e?$("#key span.tropStrm").show():$("#key span.tropStrm").hide(),0!=a?$("#key span.hur").show():$("#key span.hur").hide(),0!=s?$("#key span.majHur").show():$("#key span.majHur").hide()}$.fn.scrollTo=function(t,e,a){"function"==typeof e&&2==arguments.length&&(a=e,e=t);var s=$.extend({scrollTarget:t,offsetTop:50,duration:500,easing:"swing"},e);return this.each(function(){var t=$(this),e="number"==typeof s.scrollTarget?s.scrollTarget:$(s.scrollTarget),n="number"==typeof e?e:e.offset().top+t.scrollTop()-parseInt(s.offsetTop);t.animate({scrollTop:n},parseInt(s.duration),s.easing,function(){"function"==typeof a&&a.call(this)})})};var o,i,g=[],c=[],m=[],u=[];latLng=[{lat:30.751278,lng:-115.664062},{lat:40.580587,lng:-60.820312},{lat:-10.314919,lng:-60.820312},{lat:-12.21118,lng:96.503906},{lat:-39.368279,lng:121.464844},{lat:-18.312811,lng:-132.363281},{lat:-.35156,lng:153.632813}];var d;d=new google.maps.Map(document.getElementById("gmap"),{zoom:3,center:{lat:23.133,lng:-82.3833},mapTypeId:google.maps.MapTypeId.SATELLITE,stylers:[{lightness:50}]});var h,y,f,L="",v="NA.min.json",b="North Atlantic",S="2014";$.getJSON("json/basin/"+v,function(t){for($("#b_selected").text(b),$("#y_selected").text(S),h=0;h<t.year.length;h++){var e=[];t.year.length;if(u.push(t.year[h]["@attributes"].id),"2013"==t.year[h]["@attributes"].id){for(m.push({stName:t.year[h].storm.stormName,stCode:t.year[h].storm.strmID}),p=0;p<t.year[h].storm.latLng.length;p++){var a=new google.maps.LatLng(parseFloat(t.year[h].storm.latLng[p].latitude),parseFloat(t.year[h].storm.latLng[p].longitude));e.push(a)}n(e)}}unique=u.filter(function(t,e,a){return e==u.indexOf(t)});var s=unique.length;for(f=s-1;f>=0;f--)$("#years").append($("<option>",{value:unique[f],"class":unique[f],text:unique[f]}));m.sort();var r=m.length;for(y=0;r>y;y++)$("#storm-toggle").append($("<li>",{id:"2013",text:m[y].stName,"data-code":m[y].stCode}));$("#s_selected").empty()}),$("#basin").change(function(){switch(s(null),r(),null!=i&&i.setMap(null),$("#years, #storm-toggle, #hurr").empty(),$("#years, .strmList").hide(),L=$(this).val()){case"EP.min.json":v="EP.min.json",e(latLng[0].lat,latLng[0].lng),$("#b_selected").text("Eastern Pacific");break;case"NA.min.json":v="NA.min.json",e(latLng[1].lat,latLng[1].lng),$("#b_selected").text("North Atlantic");break;case"NI.min.json":v="NI.min.json",e(latLng[3].lat,latLng[3].lng),$("#b_selected").text("North Indian");break;case"SA.min.json":v="SA.min.json",e(latLng[2].lat,latLng[2].lng),$("#b_selected").text("South Atlantic");break;case"SI.min.json":v="SI.min.json",e(latLng[4].lat,latLng[4].lng),$("#b_selected").text("South Indian");break;case"SP.min.json":v="SP.min.json",e(latLng[5].lat,latLng[5].lng),basin="SP",$("#b_selected").text("South Pacific");break;case"WP.min.json":v="WP.min.json",e(latLng[6].lat,latLng[6].lng),$("#b_selected").text("Western Pacific")}$.getJSON("json/basin/"+v,function(t){var e=[];for(u=[],m=[],h=0;h<t.year.length;h++){t.year.length;u.push(t.year[h]["@attributes"].id)}e=u.filter(function(t,e,a){return e==u.indexOf(t)});var a=e.length;for(f=a-1;f>=0;f--)$("#years").append($("<option>",{value:e[f],"class":e[f],text:e[f]}));$("#years").prepend($("<option>",{value:"Select a year",text:"Select a year",selected:"selected",disabled:"disabled"})),$("#years").show(),$("#y_selected, #s_selected").empty()})}),$("#years").change(function(){$("#storm-toggle, #hurr, #s_selected").empty(),s(null),r(),null!=i&&i.setMap(null),$("#hurr").empty(),m=[],strmYear=$(this).val(),$("#y_selected").text(strmYear),$.getJSON("json/basin/"+v,function(t){for($("#orig").empty(),h=0;h<t.year.length;h++)if(path=[],t.year[h]["@attributes"].id==strmYear){for(m.push({stName:t.year[h].storm.stormName,stCode:t.year[h].storm.strmID}),p=0;p<t.year[h].storm.latLng.length;p++){var e=new google.maps.LatLng(parseFloat(t.year[h].storm.latLng[p].latitude),parseFloat(t.year[h].storm.latLng[p].longitude));path.push(e)}n(path)}m.sort();var a=m.length;for(y=0;a>y;y++)$("#storm-toggle").append($("<li>",{id:strmYear,text:m[y].stName,"data-code":m[y].stCode}))}),$(".strmList").show()}),$("#storm-toggle").on("click","li",function(){$("#hurr").empty(),s(null),null!=i&&i.setMap(null);var e=$(this).text(),n=$(this).attr("data-code"),r=$(this).attr("id");$("#s_selected").text(e),$("#y_selected").text(r),$.getJSON("json/basin/"+v,function(s){for(h=0;h<s.year.length;h++)if(r==s.year[h]["@attributes"].id&&n==s.year[h].storm.strmID&&e==s.year[h].storm.stormName){var o=parseInt(s.year[h].storm.latLng[0].windSpeed),g=1.15078*o,c=s.year[h].storm.latLng[0].avgPeriod,m=s.year[h].storm.latLng[0].minPressure,u=s.year[h].storm.latLng[0].time;yr=u.substring(0,4);var y=u.substring(5,7),f=u.substring(8,10),L=u.substring(11,19);$("#orig").html('<div id="orgTime"><span class="ti">Storm Formation Date:</span> '+y+"/"+f+"/"+yr+' | <span class="ti">Time:</span> '+L+'</div><div><span class="wS"><span class="ti">Wind Speed:</span> '+Math.ceil(g)+' mph</span> | <span class="aP"><span class="ti">Averaging Period:</span> '+c+' mins</span> | <span class="mP"><span class="ti">Minimum Atmospheric Pressure:</span> '+m+" mbar</span></div>");var v=[];for(p=0;p<s.year[h].storm.latLng.length;p++){var b=new google.maps.LatLng(parseFloat(s.year[h].storm.latLng[p].latitude),parseFloat(s.year[h].storm.latLng[p].longitude));$.each(b,function(){v.push(b)});var S=Math.ceil(s.year[h].storm.latLng.length/2);t(parseFloat(s.year[h].storm.latLng[S].latitude),parseFloat(s.year[h].storm.latLng[S].longitude));var k=parseInt(s.year[h].storm.latLng[p].windSpeed),x=1.15078*k,j=s.year[h].storm.latLng[p].avgPeriod,w=s.year[h].storm.latLng[p].minPressure,P=s.year[h].storm.latLng[p].time,D=P.substring(0,4),T=P.substring(5,7),N=P.substring(8,10),M=P.substring(11,19),_='<img src="img/pin.png" class="pin" alt ="pin-button"/><div class="i"><div><span class="info">Date: '+T+" / "+N+" / "+D+" | Time: "+M+'</div><span class="info">Lat: <span class="lat">'+s.year[h].storm.latLng[p].latitude+'</span></span> | <span class="info">Long: <span class="lon">'+s.year[h].storm.latLng[p].longitude+'</span></span><div><span class="wS"><span class="ti">Wind Speed:</span> '+Math.ceil(x)+' mph</span> | <span class="aP"><span class="ti">Averaging Period:</span> '+j+' mins</span> | <span class="mP"><span class="ti">Minimum Atmospheric Pressure:</span> '+w+" mbar</span></div></div>";38>x?$("#hurr").append($("<div>",{"class":"tropDep strmData","data-code":p,html:_})):x>38&&73>x?$("#hurr").append($("<div>",{"class":"tropStrm strmData","data-code":p,html:_})):x>73&&110>x?$("#hurr").append($("<div>",{"class":"hur strmData","data-code":p,html:_})):x>80&&$("#hurr").append($("<div>",{"class":"majHur strmData","data-code":p,html:_}))}}i=new google.maps.Polyline({path:v,geodesic:!1,strokeColor:"#cc2000",strokeOpacity:1,strokeWeight:5}),l(),i.setMap(d),$.each($(".strmData").click(function(){var t=$(this).find(".lat").text(),e=$(this).find(".lon").text(),s=new google.maps.LatLng(parseFloat(t),parseFloat(e));a(s)}))})}),$("#key span.tropDep").click(function(){$("#hurr").scrollTo("#hurr .tropDep:eq(0)",5200,{easing:"elasout"})}),$("#key span.tropStrm").click(function(){$("#hurr").scrollTo("#hurr .tropStrm:eq(0)",5200,{easing:"elasout"})}),$("#key span.hur").click(function(){$("#hurr").scrollTo("#hurr .hur:eq(0)",5200,{easing:"elasout"})}),$("#key span.majHur").click(function(){$("#hurr").scrollTo("#hurr .majHur:eq(0)",5200,{easing:"elasout"})}),$("#mSheader").on("click",function(){$("#storm-toggle").toggle()}),$("#hideStorm").on("click",function(){$("#orig").toggle(),"Hide Storm Data"==$("#hideStorm").text()?$("#hideStorm").text("Show Storm Data"):$("#hideStorm").text("Hide Storm Data")}),$("#clear").click(function(){r(),$("#storm-toggle").empty(),null!=i&&i.setMap(null),$("#hurr, #orig, #y_selected, #s_selected").empty()}),$("#storm-toggle li").length>0?$("#sidebar-header").show():$("#sidebar-header").hide(),google.maps.event.addDomListener(window,"load")});